<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Food Request - Share A Bite</title>

  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
</head>

<body style="background-color: #9e9797;">

<th:block th:replace="~{fragments/header :: header}"></th:block>

<div class="container d-flex justify-content-center align-items-center"
     style="min-height: 80vh;">

  <form th:action="@{/user/foodrequest/create}" th:object="${foodRequestCreateDTO}" method="post"
        class="w-100 bg-white p-4 rounded shadow"
        style="max-width: 550px;">

    <!-- Title -->
    <div class="text-center mb-3">
      <h4>Create Food Request</h4>
      <p class="text-muted mb-0">Tell us what you need in your region</p>
    </div>

    <!-- Global error (optional) -->
    <div th:if="${#fields.hasGlobalErrors()}"
         class="alert alert-danger py-2">
            <span th:each="err : ${#fields.globalErrors()}"
                  th:text="${err}">Error</span>
    </div>

    <!-- Region -->
    <div class="mb-3">
      <label class="form-label">Region</label>
      <select class="form-select"
              th:field="*{region}">
        <option value="" disabled
                th:selected="${region == null}">
          -- Select region --
        </option>
        <option th:each="reg : ${T(gr.shareabite.app.core.enums.Region).values()}"
                th:value="${reg}"
                th:text="${reg}">
        </option>
      </select>
      <div class="text-danger small mt-1"
           th:if="${#fields.hasErrors('region')}"
           th:errors="*{region}">
        Region error
      </div>
    </div>

    <!-- Requested items (loop over the list) -->
    <div class="border rounded p-3 mb-3 bg-light"
         th:each="item, iterStat : *{requestedItemList}">
      <h6 class="mb-3">
        Requested item <span th:text="${iterStat.index + 1}"></span>
      </h6>

      <!-- Food item -->
      <div class="mb-2">
        <label class="form-label">Food item</label>
        <select class="form-select"
                th:field="*{requestedItemList[__${iterStat.index}__].foodItems}">
          <option value="" disabled>-- Select food item --</option>
          <option th:each="fi : ${T(gr.shareabite.app.core.enums.FoodItems).values()}"
                  th:value="${fi}"
                  th:text="${fi}">
          </option>
        </select>
        <div class="text-danger small mt-1"
             th:errors="*{requestedItemList[__${iterStat.index}__].foodItems}">
          Food item error
        </div>
      </div>

      <!-- Quantity -->
      <div class="mb-2">
        <label class="form-label">Quantity</label>
        <input type="number"
               min="1"
               class="form-control"
               th:field="*{requestedItemList[__${iterStat.index}__].quantity}">
        <div class="text-danger small mt-1"
             th:errors="*{requestedItemList[__${iterStat.index}__].quantity}">
          Quantity error
        </div>
      </div>

      <!-- Unit (dropdown) -->
      <div class="mb-2">
        <label class="form-label">Unit</label>
        <select class="form-select"
                th:field="*{requestedItemList[__${iterStat.index}__].unit}">
          <option value="" disabled>Choose unit</option>
          <option value="kg">kg</option>
          <option value="l">liters</option>
          <option value="pcs">pieces</option>
          <option value="pack">pack</option>
        </select>
        <div class="text-danger small mt-1"
             th:errors="*{requestedItemList[__${iterStat.index}__].unit}">
          Unit error
        </div>
      </div>
    </div>

    <!-- CSRF -->
    <input type="hidden"
           th:name="${_csrf.parameterName}"
           th:value="${_csrf.token}"/>

    <!-- Submit / Cancel / add items-->
    <div class="d-flex justify-content-between mt-3">

      <!-- Left: Add item -->
      <button type="submit"
              class="btn btn-outline-primary"
              name="action"
              value="addItem">Add item</button>
      <!-- Right: Cancel + Submit -->
      <div>
      <a th:href="@{/}" class="btn btn-outline-secondary me-2">Cancel</a>
      <button type="submit"
              class="btn btn-dark"  name="action" value="submit">Submit request</button>
    </div></div>

  </form>
</div>

<th:block th:replace="~{fragments/footer :: footer}"></th:block>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
